<html>
<head>
<script src="/js/utils.js" type="text/javascript"></script>
<script type="text/javascript">
function createResponse(action){
	return {
		"action": action,
		"tocyrillic.button": localStorage["tocyrillic.button"],
        "tocyrillic.global": localStorage["tocyrillic.global"],
        "tocyrillic.global.mode": localStorage["tocyrillic.global.mode"]
    };
}
// send localStorage properties to requester
chrome.extension.onRequest.addListener(	function(request, sender, sendResponse) {
	// return all properties
	if(request.action == "getProperties"){
		sendResponse(createResponse());
	}
	// accept global toggle mode and propagete it to all windows all tabs
	else if(request.action == "propagateGlobalToggleMode"){
		localStorage["tocyrillic.global.mode"] = request["tocyrillic.global.mode"];
		sendRequestToAllTabs(createResponse("setProperties"));
	}
});
</script>
</head>
</html>
